# Binary Exploitation  

## format string 0  

A **format string vulnerability** is a security flaw or kind of bug that occurs when a program allows the users' input to be used in formatting fuctions such as **printf()**, **scanf()**, etc. This happens especially in **C** or **C++**.  
**Format specifiers** are those specific codes used in functions like printf(), etc. that control how data will be displayed. They begin with a **%** symbol and are followed by charcaters that specify the data type or formatting style, for eg, **%d** for integers, **%s** for strings, **%x** for hexadecimal numbers, etc.

Usually, printf() expects a particular kind of message with format specifiers that tell it how to format the output. But when a user types something that include special characters as well, it can leak hidden data in memory or reveal some senstive info. This can also allow any hacker to take control of the program.  

For eg: If a hacker inserts `%x %x %x %x %x`, the program could output various parts of its internal memory, that might leak some info in hexadecimal format from the memory, thus revealing data.   


In this challenge, we given a binary code and a source code of C language.  
![image](https://github.com/user-attachments/assets/1e8db8e7-135c-4ae5-94b0-5aa1cfd4161e)  

I downloaded both and tried to first convert the binary code to readable format but that wasn't really needed 
as it just contained the lines from the C language code. So I tried executing the program in the terminal using CodeBlocks, which showed this error regarding gid_t:  
![image](https://github.com/user-attachments/assets/f4a98f3f-2f07-4950-8e33-a5f2228d2772)

![image](https://github.com/user-attachments/assets/140a7999-9e5d-48b9-8a9a-6e1032f0e54f)  

Then I asked gpt to correct the code to work for me. It just changed those few lines, enabling the code to run atleast.  
```
#ifdef __unix__  // Only include this part for Unix-based systems
    gid_t gid = getegid();
    setresgid(gid, gid, gid);
    #endif  
```
Then, I ran the code, where it asked for choice, starting from first I entered `Breakf@st_Burger`, which showed the following.  
```
Welcome to our newly-opened burger place Pico 'n Patty! Can you help the picky customers find their favorite burger?
Here comes the first customer Patrick who wants a giant bite.
Please choose from the following burgers: Breakf@st_Burger, Gr%114d_Cheese, Bac0n_D3luxe
Enter your recommendation: Breakf@st_Burger
Breakf@st_BurgerPatrick is still hungry!
Try to serve him something of larger size!

Process returned 0 (0x0)   execution time : 98.186 s
Press any key to continue.
```

I went back and saw the hints which stated to try out different options. So I went on with `Gr%114d_Cheese`. This time, it accelerated the output.   
Also, if we analyze the C code carefully, we can see that by entering what choice we can move on.  
```
Welcome to our newly-opened burger place Pico 'n Patty! Can you help the picky customers find their favorite burger?
Here comes the first customer Patrick who wants a giant bite.
Please choose from the following burgers: Breakf@st_Burger, Gr%114d_Cheese, Bac0n_D3luxe
Enter your recommendation: Gr%114d_Cheese
Gr                                                                                                        1701144576_Cheese
Good job! Patrick is happy! Now can you serve the second customer?
Sponge Bob wants something outrageous that would break the shop (better be served quick before the shop owner kicks you out!)
Please choose from the following burgers: Pe%to_Portobello, $outhwest_Burger, Cla%sic_Che%s%steak
Enter your recommendation: Pe%to_Portobello
Pe625673207216533622000_Portobello
Process returned 0 (0x0)   execution time : 25.240 s
Press any key to continue.
```

Seeing this output, I thought maybe this is related to the flag, but it wasn't. I also tried typing %s or %x several times as input, but it just printed this:    
```
Enter your recommendation: %x %x %x %x
There is no such burger yet!
```
Moving on, I realised that the option must include **%** symbol, which helps the most to crack sensitive information, and hence the flag. Therefore, I chose `Cla%sic_Che%s%steak` next. (as previously, Gr%114d_Cheese worked)
```
Please choose from the following burgers: Pe%to_Portobello, $outhwest_Burger, Cla%sic_Che%s%steak
Enter your recommendation:  Cla%sic_Che%s%steak
Cla
```
Some characters went missing, which prompted me to shift to WSL instead of CodeBlocks.  
I ran the program using `gcc -o exploit format-string-0.c` and then `./exploit`, but it started showing errors.  
![image](https://github.com/user-attachments/assets/67ba2fee-4128-405d-87a8-8864e91e1098)


Then tried running the code by using `nc mimas.picoctf.net 63376` command(given in the description when we launch instance). 
Finally, this gave the flag!  
![image](https://github.com/user-attachments/assets/3b6cc30f-9de8-43e0-ac35-109e97677896)

**Flag:** `picoCTF{7h3_cu570m3r_15_n3v3r_SEGFAULT_63191ce6}`  



